# 进程的描述与控制

## 进程的控制

### 操作系统内核

- 支撑功能

	- （1）中断处理
	- （2）时钟管理
	- （3）原语操作

		- 进程的管理，由若干原语来执行

- 资源管理功能

	- 进程管理
	- 存储器管理
	- 设备管理

### 处理及执行状态

- 系统态（内核态）

	- 可执行一切指令，访问所有寄存器和存储区

- 用户态（目态）

	- 仅能执行规定的指令，访问指定寄存器和存储区
	- 一般情况下，应用程序只能在用户态运行。

### 进程创建

- 进程的层次结构

	- 父进程
	- 子进程

- 进程图

	- 2-13.PNG

- 引起创建进程的事件

	- （1）用户登录
	- （2）作业调度
	- （3）提供服务
	- （4）应用请求

- 进程的创建

	- （1）申请空白PCB
	- （2）为新进程分配其运行所需资源
	- （3）初始化进程块PCB
	- （4）若进程就绪队列能够接纳新进程，便将新进程插入就绪队列

- 进程的终止

	- 引起进程终止的事件

		- 正常结束
		- 异常结束
		- 外界干预

	- 进程的终止过程

		- （1）根据被终止进程的标识符，从PCB集合中检索出该进程的PCB，从中读出该进程状态。
		- （2）若杯终止进程正处于执行状态，则立即终止进程执行。
		- （3）若该进程还要子孙进程，还应将其所有子孙进程也都予以终止，防止其不可控。
		- （4）将被终止进程所拥有的全部资源或归还给其父进程，或者归还系统。
		- （5）将被终止进程从所在队列或链表中移出，等待其他程序搜集信息。

- 进程的阻塞与唤醒

	- 引起进程阻塞与唤醒的事件

		- 请求系统服务而未满足
		- 启动某种操作而阻塞当前进程
		- 新数据尚未到达
		- 等待新任务到达

	- 进程阻塞过程

		- 自己阻塞自己

	- 进程唤醒过程

		- 系统或其他进程唤醒自己

- 进程的挂起与激活

	- 挂起（suspend）
	- 激活（active）

## 进程同步

### 基本概念

- 两种形式的制约关系

	- 间接相互制约（资源共享）

		- 互斥——竞争

	- 直接相互制约（进程合作）

		- 同步——协作

- 临界资源
- 分区

	- 进入区

		- 只允许一个进程进入

	- 临界区

		- 每个进程中访问临界资源的那段代码

	- 退出区
	- 剩余区

- 同步机制应遵循的规则

	- 空闲让进
	- 忙则等待
	- 有限等待
	- 让权等待

### 硬件同步机制

- 关中断

	- 作用

		- 保证对锁的测试和关锁操作的连续性和完整性
		- 有效地保证了互斥

	- 缺点

		- 滥用可能导致严重后果
		- 时间过长会影响系统效率，限制了处理器交叉执行程序的能力
		- 不适用于多CPU系统

- 利用Test-and-Set实现互斥
- 利用Swap实现进程互斥

### 信号量机制

- 整型信号量
- 记录型信号量

	- 由于整型信号量没有遵循让权等待原则，记录型允许负数，即阻塞链表

- AND型信号量
- 信号量集

	- 理解

		-      AND型信号量的wait和signal仅能对信号量施以加1减1操作，意味着每次只能对某类临界资源进行一个单位的申请或释放。当一次需要N个单位时，便要进行N次wait操作，低效且增加死锁概率。此外，在有些情况下，为确保系统的安全性，当所申请的资源数量低于某一下限值时，还必须进行管制，不予以分配。因此，当进程申请某类临界资源时，在每次分配前，都必须测试资源数量，判断是否大于可分配的下限值，决定是否予以分配。

	- 操作

		- Swait(S1, t1, d1, ..., tn, dn)
		- Ssignal(S1, d1, ..., Sn, dn)

- 特征

	- 原子操作
	- 仅支持加减操作

		- wait——减
		- signal——加

	- wait不成功——>进程等待
	- signal每次都能够成功

- 经典进程同步问题

	- 生产者——消费者
	- 哲学家进餐
	- 读者——写者

## 进程通信

### 定义

- 进程之间的信息交换（信息在进程中的转移）

### 类型

- 共享存储器系统

	- 基于共享数据结构的通信方式

		- 仅适于传递相对少量的数据，通信效率低下（低级通信）

	- 基于共享存储区的通信方式

		- 高级通信

- 管道通信系统

	- 提供三方面协调能力

		- 互斥
		- 同步
		- 确定是否存在

	- 高级通信

- 消息传递系统

	- 直接通信方式
	- 间接通信方式

- 客户机——服务器系统

### 实现方式

- 直接消息传递系统
- 信箱通信（间接）

	- 需要通过某种中间实体完成

## 线程基本概念

### 引入

- 目的

	- 使多个程序能并发执行，以提高资源利用率和系统吞吐量。

### 基本属性

- ①进程是一个可拥有资源的独立单位，可独立分配系统资源
- ②还是一个可独立调度分配的基本单位（PCB）

### 程序并发执行所需付出的时空开销

- 创建进程
- 撤销进程
- 进程切换

### 线程——作为调度和分配的基本单位

- 进程——系统资源分配的单位
线程——处理器调度的单位
- 线程表示进程的一个控制点，可执行一系列指令
- 进程可分解为线程还可以有效用多处理器和多核计算机

## 进程描述

### 定义

- 是程序在内存当中的一次运行
- *由程序段、数据段及PCB构成的进程实体
- 作为资源分配的基本单位

### 特征

- 动态性

	- 进程实质是进程实体的执行过程

- 并发性

	- 多个进程实体同存于内存中

- 独立性

	- 进程实体是一个能独立运行、独立获得资源和独立接受调度的基本单位

- 异步性

	- 进程按异步方式运行

### 基本状态及转换
（三状态四切换两不可能）

- 类别

	- 就绪状态
	- 执行状态
	- 阻塞状态

- **转换

	- 2-5.PNG
	- 不可能的转换

		- 1、阻塞——>执行
		- 2、就绪——>阻塞

- 创建/终止状态

	- 五状态进程模型 2-6.PNG

### 与程序的区别和联系

- 区别

	- 进程是动态概念，程序是静态概念
	- 程序是指令的有序集合，永远存在；
进程强调程序在数据集上的一次执行，有创建和终止，暂时存在。
	- 进程具有并发性，而程序没有
	- 进程可创建其他进程，而程序不能形成新的程序
	- 进程是竞争计算机资源的基本单位

- 联系

	- 程序是构成进程的组成部分，一个程序对应多个进程，一个进程也可包括多个程序。
	- 进程的运行目标是执行所对应的程序
	- 进程的定义

### 挂起操作和进程状态转换

- 挂起和阻塞区别
- 挂起的目的

	- ①终端用户的需要：修改、检查进程
	- ②父进程请求：修改、协调子进程
	- ③负荷调节的需要：保证实时任务的执行
	- ④操作系统的需要：检查资源使用或进行进账

- 2-7.PNG

### 进程管理中的数据结构

- 用于管理控制的数据结构
- 进程控制块PCB的作用

	- 作为独立运行基本单位的标志

		- PCB已成为进程存在于系统中的唯一标志

	- 能实现间断性运行方式
	- 提供进程管理所需信息
	- 提供进程调度所需信息
	- 实现与其他进程的同步与通信

- 进程控制块的信息

	- 进程标识符

		- 用于唯一地标识一个进程。
		- 种类

			- 外部标识符PID

				- 进程的身份证号

			- 内部标识符（端口）

	- 处理机状态

		- 通用寄存器（用户可视寄存器）
		- 指令计数器

			- 存放要访问的下一条指令的地址

		- 程序状态字PSW
		- 用户栈指针

	- 进程调度信息

		- 进程状态

			- 进程调度和兑换时的依据

		- 进程优先级
		- 进程调度所需的其他信息
		- 事件

			- 阻塞原因

	- 进程控制信息

		- 程序和数据的地址
		- 进程同步和通信机制
		- 资源清单
		- 链接指针

			- 提供PCB所在队列的下一进程的PCB首地址

- 继承控制块组织方式

	- 线性方式
	- 链接方式
	- 索引方式

## 程序执行

### 程序顺序执行

- 特征

	- 1、顺序性
2、封闭性
3、可再现性

### 程序并发执行

- 特征

	- 1、间断性
2、失去封闭性
3、不可再现性

## 前趋图

### 一个有向五循环图（DAG），用于描述进程之间执行的先后顺序。

### ①结点表示一个进程或进程段
②结点间有向边表示两结点间存在的偏序或前趋关系（前后约束）

### 初始结点：没有前趋
终止结点：没有后继

## 进程与线程的比较

### 不同

- 进程调度开销大，线程小
- 进程拥有全部运行所需的资源，线程拥有部分资源
- 进程拥有独立性，而线程不具有且依附于进程
- 进程是作为独立调度和分派的基本单位，线程是能独立运行的基本单位

### 相似点

- 都具有并发性

## 线程的实现

### 实现方式

- 内核支持线程 KST
- 用户级线程 ULT
- 组合方式

*XMind - Trial Version*